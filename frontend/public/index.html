<!DOCTYPE html>
<html>
<head>
  <title>Feedback API Tester</title>
</head>
<body>
  <h1>ğŸ§ª Feedback System Tester</h1>

  <h2>ğŸ” Login</h2>
  <form id="login-form">
    Username: <input type="text" id="username" required><br>
    Password: <input type="password" id="password" required><br>
    <button type="submit">Login</button>
  </form>
  <p><strong>Access Token:</strong> <span id="token-display"></span></p>

  <hr>

  <h2>ğŸ“ Submit Feedback (Manager only)</h2>
  <form id="feedback-form">
    Employee ID: <input type="number" id="employee_id" required><br>
    Strengths: <input type="text" id="strengths" required><br>
    Improvements: <input type="text" id="improvements" required><br>
    Sentiment:
    <select id="sentiment">
      <option value="positive">Positive</option>
      <option value="neutral">Neutral</option>
      <option value="negative">Negative</option>
    </select><br>
    <button type="submit">Submit Feedback</button>
  </form>

  <hr>

  <h2>ğŸ“œ View Feedback History</h2>
  <form id="history-form">
    Employee ID: <input type="number" id="history_employee_id" required><br>
    <button type="submit">View Feedback</button>
  </form>
  <pre id="history-output"></pre>

  <script>
    let token = "";

    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const response = await fetch("https://<YOUR-BACKEND-URL>/auth/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          username,
          password
        })
      });

      const data = await response.json();
      token = data.access_token;
      document.getElementById("token-display").innerText = token || "Login failed";
    });

    document.getElementById("feedback-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const response = await fetch("https://<YOUR-BACKEND-URL>/feedback/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          employee_id: document.getElementById("employee_id").value,
          strengths: document.getElementById("strengths").value,
          improvements: document.getElementById("improvements").value,
          sentiment: document.getElementById("sentiment").value
        })
      });

      const result = await response.json();
      alert("Response: " + JSON.stringify(result, null, 2));
    });

    document.getElementById("history-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = document.getElementById("history_employee_id").value;

      const response = await fetch(`https://feedback-sys-w29g.onrender.com/${id}`, {
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await response.json();
      document.getElementById("history-output").innerText = JSON.stringify(data, null, 2);
    });
  </script>
</body>
</html>
